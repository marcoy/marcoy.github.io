<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Marco Yuen</title>
    <description>Life and Programming</description>
    <link>http://www.marcoyuen.com/</link>
    <atom:link href="http://www.marcoyuen.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Tue, 07 Jun 2016 10:40:35 -0400</pubDate>
    <lastBuildDate>Tue, 07 Jun 2016 10:40:35 -0400</lastBuildDate>
    <generator>Jekyll v3.1.6</generator>
    
      <item>
        <title>Some Updates</title>
        <description>&lt;div class=&quot;paragraph&quot;&gt;
&lt;p&gt;I have been on hiatus for more than two years now.
So I have decided to update the site&amp;#8217;s layout and add some new content.
Since the past two years, a lot have changes.
I have a different job, and I get even more into functional programming.
In addition to Clojure, I get into Haskell, and recently Scala.&lt;/p&gt;
&lt;/div&gt;</description>
        <pubDate>Sun, 05 Jun 2016 00:00:00 -0400</pubDate>
        <link>http://www.marcoyuen.com/articles/2016/06/05/updates.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/articles/2016/06/05/updates.html</guid>
        
        
        <category>articles</category>
        
      </item>
    
      <item>
        <title>Compojure restart workflow</title>
        <description>&lt;p&gt;Recently I’ve been reading the excellent &lt;a href=&quot;http://pragprog.com/book/dswdcloj/web-development-with-clojure&quot;&gt;Web Development with
Clojure&lt;/a&gt;. As I’m
following along, I found myself constantly restarting the REPL because of either
a new module or a new function is introduced. The time it takes for the REPL to
restart is long enough that it breaks my
&lt;a href=&quot;http://en.wikipedia.org/wiki/Flow\_(psychology)&quot;&gt;flow&lt;/a&gt;. I don’t know why the
REPL restart time did not bother me as much when I was working on my recent
projects, &lt;a href=&quot;&quot;&gt;Shows&lt;/a&gt; and &lt;a href=&quot;/articles/2014/02/15/bitpub.html&quot;&gt;Bitpub&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;In any case, a tight feedback loop is essential to REPL-driven development. I
understand there is a famous
&lt;a href=&quot;http://thinkrelevance.com/blog/2013/06/04/clojure-workflow-reloaded&quot;&gt;blog&lt;/a&gt; post
by &lt;a href=&quot;http://stuartsierra.com/&quot;&gt;Stuart Sierra&lt;/a&gt; regarding his workflow, and a
&lt;a href=&quot;https://github.com/zcaudate/vinyasa&quot;&gt;few&lt;/a&gt; &lt;a href=&quot;https://github.com/juxt/jig&quot;&gt;other&lt;/a&gt;
&lt;a href=&quot;https://github.com/stuartsierra/component&quot;&gt;projects&lt;/a&gt; that help with Clojure
workflow. Ultimately, I decided to use Stuart’s idea and
&lt;a href=&quot;https://github.com/clojure/tools.namespace&quot;&gt;tools.namespace&lt;/a&gt; to create a quick
and dirty solution that helps me as I follow along the book.&lt;/p&gt;

&lt;p&gt;Following Stuart’s idea, I have a constructor for the app. It returns a map,
that contains an atom which then holds an instance of the application server,
jetty. But notice that it is private.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn- &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;create-app&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:server&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;atom&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)})&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The way to start the app is to use the &lt;code&gt;start&lt;/code&gt; function. One way I make it more
convenient for myself, but less portable is the use of &lt;code&gt;intern&lt;/code&gt;. I use &lt;code&gt;intern&lt;/code&gt;
to create a &lt;code&gt;Var&lt;/code&gt; in the &lt;code&gt;user&lt;/code&gt; namespace called &lt;code&gt;app&lt;/code&gt;. The value of the
&lt;code&gt;user/app&lt;/code&gt; is the return value of &lt;code&gt;create-app&lt;/code&gt;, the constructor.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;start&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;var-get &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;intern&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;user&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;app&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create-app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Integer/parseInt&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8080&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;reset!&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:server&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;serve&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;get-handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;                   &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:port&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;ss&quot;&gt;:init&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;init&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;ss&quot;&gt;:auto-reload?&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;ss&quot;&gt;:destroy&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;destroy&lt;/span&gt;
&lt;a name=&quot;line-10&quot;&gt;&lt;/a&gt;                    &lt;span class=&quot;ss&quot;&gt;:join&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}))&lt;/span&gt;
&lt;a name=&quot;line-11&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;println &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str &lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;You can view the site at http://localhost:&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Reloading is very similar to how it is described in the
&lt;a href=&quot;https://github.com/clojure/tools.namespace#warnings-for-helper-functions&quot;&gt;README&lt;/a&gt;
of &lt;a href=&quot;https://github.com/clojure/tools.namespace&quot;&gt;tools.namespace&lt;/a&gt;. Everytime
&lt;code&gt;restart&lt;/code&gt; is called, it will stop the current application server, refresh all
the namespaces that are changed and start a new application server.
one&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;stop&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; gallery.repl is the module where&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; start and restart are defined&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;refresh&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:after&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;&amp;#39;gallery.repl/start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now my work flow becomes quite compact and fast. No more restarting the REPL.
Plus, I can experiment in the REPL against the running application.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;&lt;span class=&quot;c1&quot;&gt;;; editing...&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;&lt;span class=&quot;c1&quot;&gt;;; The start function intern&amp;#39;s app into the user namespace.&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;&lt;span class=&quot;c1&quot;&gt;;; So, I can pass it into restart.&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;&lt;span class=&quot;c1&quot;&gt;;; more editing...&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;restart&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There are quite a few drawbacks to my approach, but, so far, it works quite well
for my use case. If you are developing a proper application from scratch, I
would suggest using either
&lt;a href=&quot;https://github.com/stuartsierra/component&quot;&gt;compojure&lt;/a&gt;, or
&lt;a href=&quot;https://github.com/juxt/jig&quot;&gt;jig&lt;/a&gt;.&lt;/p&gt;
</description>
        <pubDate>Tue, 11 Mar 2014 00:00:00 -0400</pubDate>
        <link>http://www.marcoyuen.com/articles/2014/03/11/compojure-restart-workflow.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/articles/2014/03/11/compojure-restart-workflow.html</guid>
        
        <category>clojure</category>
        
        <category>compojure</category>
        
        
        <category>articles</category>
        
      </item>
    
      <item>
        <title>Introducing bitpub</title>
        <description>&lt;p&gt;&lt;a href=&quot;https://github.com/marcoy/bitpub&quot;&gt;Bitpub&lt;/a&gt; was a project I started about two
months ago. One of the main goals of the project is to build something that
utilizes RabbitMQ. In essence, bitpub fetches Bitcoin ticker data from various
sources, and publishes them to a RabbitMQ’s topic exchange. Please read the
&lt;a href=&quot;https://github.com/marcoy/bitpub/blob/master/README.md&quot;&gt;README&lt;/a&gt; of
&lt;a href=&quot;https://github.com/marcoy/bitpub&quot;&gt;Bitpub&lt;/a&gt; on how to run the publisher and
consumer.&lt;/p&gt;

&lt;h4 id=&quot;polling&quot;&gt;Polling&lt;/h4&gt;
&lt;p&gt;The project uses &lt;a href=&quot;https://github.com/clojure/core.async&quot;&gt;core.async&lt;/a&gt; to poll the
sources for ticker data. The supported sources are &lt;a href=&quot;https://campbx.com&quot;&gt;CampBx&lt;/a&gt;,
&lt;a href=&quot;https://www.bitstamp.net&quot;&gt;Bitstamp&lt;/a&gt;, &lt;a href=&quot;http://vircurex.com&quot;&gt;Vircurex&lt;/a&gt;,
&lt;a href=&quot;https://btc-e.com&quot;&gt;BTC-e&lt;/a&gt;, and &lt;a href=&quot;https://vip.btcchina.com&quot;&gt;BTC China&lt;/a&gt;. The logic
of the polling, shown below, will poll a given ticker URL to &lt;code&gt;GET&lt;/code&gt; the market
data. It will place the data returned from the &lt;code&gt;GET&lt;/code&gt; request into the &lt;code&gt;out&lt;/code&gt;
channel. If no process is consuming the &lt;code&gt;out&lt;/code&gt; channel, it will wait for a
specified time and poll the ticker URL again. This ensures the data that a
consumer receives are kept somewhat up-to-date. There is a timeout for the
initial &lt;code&gt;GET&lt;/code&gt; request. If the &lt;code&gt;GET&lt;/code&gt; request timeout has elapsed, it will retry
again. All of these polling logics are performed inside a &lt;code&gt;go&lt;/code&gt; block, which is
similar to
&lt;a href=&quot;https://gobyexample.com/goroutines&quot;&gt;goroutines&lt;/a&gt; in &lt;a href=&quot;http://golang.org/&quot;&gt;Go&lt;/a&gt;. As
a result, the polling is done in a thread pool. So, multiple &lt;em&gt;feeds&lt;/em&gt; can be
constructed, and poll concurrently.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;create-ticker-feed&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ticker-url&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:keys&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;get-timeout&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;async-put-timeout&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;park-time-fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:as&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}]&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;chan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;go-loop&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;time-out&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as/timeout&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;get-timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;nv&quot;&gt;ticker-poll&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;http-get&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ticker-url&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;            &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;alts!&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;time-out&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ticker-poll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])]&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cond&lt;/span&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ticker-poll&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;_&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;ch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;alts!&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;out&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as/timeout&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;async-put-timeout&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])]&lt;/span&gt;
&lt;a name=&quot;line-10&quot;&gt;&lt;/a&gt;                              &lt;span class=&quot;c1&quot;&gt;;; If no-one is consuming the out channel, polls&lt;/span&gt;
&lt;a name=&quot;line-11&quot;&gt;&lt;/a&gt;                              &lt;span class=&quot;c1&quot;&gt;;; the url again after some time.&lt;/span&gt;
&lt;a name=&quot;line-12&quot;&gt;&lt;/a&gt;                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;ch&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-13&quot;&gt;&lt;/a&gt;                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;do&lt;/span&gt;
&lt;a name=&quot;line-14&quot;&gt;&lt;/a&gt;                                  &lt;span class=&quot;c1&quot;&gt;;; park for a little bit before polling again&lt;/span&gt;
&lt;a name=&quot;line-15&quot;&gt;&lt;/a&gt;                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;&amp;lt;!&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;as/timeout&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;park-time-fn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-16&quot;&gt;&lt;/a&gt;                                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;recur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-17&quot;&gt;&lt;/a&gt;                                &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;recur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-18&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;c1&quot;&gt;;; HTTP GET timeout&lt;/span&gt;
&lt;a name=&quot;line-19&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;time-out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;close!&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-20&quot;&gt;&lt;/a&gt;                             &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;recur&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))))&lt;/span&gt;
&lt;a name=&quot;line-21&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;nv&quot;&gt;out&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There are a few options for &lt;code&gt;create-ticket-feed&lt;/code&gt; function. They are all related
to timings, because different sources have different timing restrictions when
polling. The timing restrictions are set in place, in order to prevent abuse. If
the &lt;code&gt;go&lt;/code&gt; block polls a source too frequently, it may get banned by the source.
The options are:&lt;/p&gt;

&lt;dl&gt;
  &lt;dt&gt;&lt;code&gt;:get-timeout&lt;/code&gt;&lt;/dt&gt;
  &lt;dd&gt;The time it waits for a reply from the GET request before retrying (in ms).&lt;/dd&gt;
  &lt;dt&gt;&lt;code&gt;:async-put-timeout&lt;/code&gt;&lt;/dt&gt;
  &lt;dd&gt;The time it waits for a consumer to consume the value (in ms).&lt;/dd&gt;
  &lt;dt&gt;&lt;code&gt;:park-time-fn&lt;/code&gt;&lt;/dt&gt;
  &lt;dd&gt;A function that returns an integer (in ms). The integer will be used as the
park time before the &lt;code&gt;go&lt;/code&gt; block re-polls the ticker url again. This is dictated by the
source’s timing restriction.&lt;/dd&gt;
&lt;/dl&gt;

&lt;p&gt;To create a feed from, say, &lt;a href=&quot;https://campbx.com&quot;&gt;CampBx&lt;/a&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create-ticker-feed&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;s&quot;&gt;&amp;quot;http://campbx.com/api/xticker.php&amp;quot;&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; GET request timed out after 30s&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ss&quot;&gt;:get-timeout&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;30000&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; If no process is consuming the out channel, re-poll&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ss&quot;&gt;:async-put-timeout&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10000&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; Wait at least 1s between each poll&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;c1&quot;&gt;;; rand-int is to introduce some variance&lt;/span&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;ss&quot;&gt;:park-time-fn&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;+ &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;rand-int &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;publishing-feeds&quot;&gt;Publishing feeds&lt;/h4&gt;
&lt;p&gt;The return value for &lt;code&gt;create-ticker-feed&lt;/code&gt; is a channel. From that channel, a
consumer can acquire the market data and then perform whatever action it needs
to perform. In the publisher’s case, whenever it receives any market data, it
will publish the data out to a topic exchange of a RabbitMQ instance.  Actually,
the publisher I implemented does a little bit more. All the data that it
receives from the channel get passed through a function (using
&lt;a href=&quot;http://clojure.github.io/core.async/#clojure.core.async/map&amp;lt;&quot;&gt;mapv&amp;lt;&lt;/a&gt;). The
function is used to clean up the market data. One example for such function is
to transform all the string keys into Clojure &lt;code&gt;keywords&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;subscribing-to-feeds&quot;&gt;Subscribing to feeds&lt;/h4&gt;
&lt;p&gt;As described earilier, the data will be published to a RabbitMQ’s topic
exchange. Each feed will have the routing key of the form &lt;code&gt;ticker.$feedname&lt;/code&gt;.
So, to subscribe to the &lt;a href=&quot;https://campbx.com&quot;&gt;CampBx&lt;/a&gt; feed, you will need to
subscribe to &lt;code&gt;ticker.campbx&lt;/code&gt;. Moreover, if you want to subscribe to all feeds,
then you will need to subscribe to &lt;code&gt;ticker.#&lt;/code&gt;.
&lt;a href=&quot;https://github.com/marcoy/bitpub&quot;&gt;Bitpub&lt;/a&gt; comes a basic consumer the subscribe
to all feeds, and dump all the data out to &lt;code&gt;STDOUT&lt;/code&gt;.&lt;/p&gt;

&lt;h4 id=&quot;final-words&quot;&gt;Final words&lt;/h4&gt;
&lt;p&gt;One of the other reasons why I started
&lt;a href=&quot;https://github.com/marcoy/bitpub&quot;&gt;bitpub&lt;/a&gt;, besides learning about RabbitMQ, was
to build a notification system for Bitcoin prices at different exchanges. So,
users can get notifications when the prices of Bitcoin rise above or fall below
some thresholds defined by the users. Another usage of bitpub is to allow
trading bot to get the market data and make decision on how to trade.&lt;/p&gt;

&lt;p&gt;Unfortunately, life and work get in the way, so I haven’t started on the rest of
the components of the notification system. And, that’s why I haven’t written
anything about &lt;a href=&quot;https://github.com/marcoy/bitpub&quot;&gt;bitpub&lt;/a&gt; until months later.
Anyway, try it and play around with it.&lt;/p&gt;
</description>
        <pubDate>Sat, 15 Feb 2014 00:00:00 -0500</pubDate>
        <link>http://www.marcoyuen.com/articles/2014/02/15/bitpub.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/articles/2014/02/15/bitpub.html</guid>
        
        <category>clojure</category>
        
        <category>bitcoin</category>
        
        <category>ticker</category>
        
        <category>marketdata</category>
        
        
        <category>articles</category>
        
      </item>
    
      <item>
        <title>Eight-Queens Puzzle</title>
        <description>&lt;p&gt;The eight queens puzzle is about placing eight queens on a 8x8 chess board such
that none of the queens share the same row, column, and diagonal. In fact there
are more than one ways to place eight queens on a chess board without violating
the rule. The puzzle can be generalized into a &lt;code&gt;n&lt;/code&gt;-queens puzzle where the player
is tasked to place &lt;code&gt;n&lt;/code&gt; queens on a &lt;code&gt;n&lt;/code&gt;x&lt;code&gt;n&lt;/code&gt; chess board.&lt;/p&gt;

&lt;p&gt;This post is about my attempt to solve the &lt;code&gt;n&lt;/code&gt;-queens puzzle using
&lt;a href=&quot;http://clojure.org/&quot;&gt;Clojure&lt;/a&gt;. The classic approach to solve the puzzle is to
use a technique called backtracking. In backtracking, the entire solution space
for the puzzle is searched until all or some of the solutions are found. In The
&lt;a href=&quot;http://www.amazon.com/Algorithm-Design-Manual-Steve-Skiena/dp/0387948600&quot;&gt;Algorithm Design Manual&lt;/a&gt;,
Steve Skiena outlines a general form of the backtracking algorithm.&lt;/p&gt;

&lt;p&gt;The idea behind the backtracking algorithm is to progressively generate
candidates that will eventually make up a solution to the problem. In the
context of eight-queens puzzle, the algorithm will place one queen at a time
until all eight queens are placed. Each newly placed queen will satisfy the rule
of the puzzle—no two queens share the same row, column, and diagonal.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;backtrack&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partial-soln&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;partial-soln&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;partial-soln&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;candidates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;gen-candidates&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;partial-soln&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;mapcat &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;backtrack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;conj &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;partial-soln&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;candidates&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n-queens&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;backtrack&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;In the above snippet, two functions are defined. The &lt;code&gt;backtrack&lt;/code&gt; function
first checks the length of the partial solution. The partial solution contains
placements of queens on the chess board. When there are placements for &lt;code&gt;n&lt;/code&gt; queens,
we know we have a single complete solution.  However, if there are less than &lt;code&gt;n&lt;/code&gt;
queens placed, the algorithm will find all the suitable placements for the next
queen while making sure the rule of the puzzle is enforced. That’s what
&lt;code&gt;gen-candidates&lt;/code&gt; does; it returns all the valid placements in the next row for a
queen. For each of the valid placements, the &lt;code&gt;backtrack&lt;/code&gt; function will append
the placement to its partial solution, then it continues to find the next valid
placement for the next queen by calling itself.  Put it another way, the
&lt;code&gt;backtrack&lt;/code&gt; function places a queen in one of the placements returned by
&lt;code&gt;gen-candidates&lt;/code&gt;, so it is one step/queen closer to finding a complete solution
of placing &lt;code&gt;n&lt;/code&gt; queens on a &lt;code&gt;n&lt;/code&gt;x&lt;code&gt;n&lt;/code&gt; chess board. The crucial bit is that
&lt;code&gt;gen-candidates&lt;/code&gt; must return proper set of candidates.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;invalid?&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;newq-row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newq-col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;cond&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newq-row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newq-col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;= &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Math/abs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;- &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newq-row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Math/abs&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;- &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;col&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;newq-col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;ss&quot;&gt;:else&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;
&lt;a name=&quot;line-10&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;validPlacements&lt;/span&gt;
&lt;a name=&quot;line-11&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-12&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;filter &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;partial &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;invalid?&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-pos&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-13&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-14&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;nv&quot;&gt;true&lt;/span&gt;
&lt;a name=&quot;line-15&quot;&gt;&lt;/a&gt;      &lt;span class=&quot;nv&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-16&quot;&gt;&lt;/a&gt;
&lt;a name=&quot;line-17&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;gen-candidates&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-18&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;last-row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;last-col&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;empty?&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-19&quot;&gt;&lt;/a&gt;                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;-1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-20&quot;&gt;&lt;/a&gt;                              &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;last &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-21&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;nv&quot;&gt;row&lt;/span&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;inc &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;last-row&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-22&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;nv&quot;&gt;cols&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;list &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;row&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;range &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))]&lt;/span&gt;
&lt;a name=&quot;line-23&quot;&gt;&lt;/a&gt;    &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;filter &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;validPlacements&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;placements&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;cols&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;The idea of &lt;code&gt;gen-candidates&lt;/code&gt; is to first generate all possible placements for
the next queen, then filter out the placements that will violate the placement
rule—no two queens share the same row, column, and diagonal. The two
functions, &lt;code&gt;validPlacements&lt;/code&gt; and &lt;code&gt;invalid?&lt;/code&gt; are used to enforce the rule of the
puzzle so no queens can attack each other.&lt;/p&gt;

&lt;p&gt;In total there are 92 possible ways to place eights queen on a chess board. You
can find all the solutions returned by calling:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;n-queens&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;&lt;span class=&quot;mi&quot;&gt;92&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Due to readability and space, I will show the solutions for a smaller
chess board. Here are the solutions for the four-queens puzzle:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;n-queens&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;([(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There are two solutions to place four queens on a 4x4 chess board. The return
value is a list that contains vectors, in this case, there are two. Each vector
holds the placements for the four queens. The placements are represented as
tuples with the first element being the row, and the second element being the
column (both start at 0).&lt;/p&gt;

&lt;p&gt;And finally, here are the solutions for six-queens:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;pprint&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;n-queens&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;([(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;There you have it. My attempt at the n-queens puzzle using clojure. I must admit
the performance is not that great, but I think it is a decent start.&lt;/p&gt;
</description>
        <pubDate>Sat, 08 Feb 2014 00:00:00 -0500</pubDate>
        <link>http://www.marcoyuen.com/articles/2014/02/08/nqueens.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/articles/2014/02/08/nqueens.html</guid>
        
        <category>clojure</category>
        
        <category>puzzle</category>
        
        
        <category>articles</category>
        
      </item>
    
      <item>
        <title>Merkle Tree</title>
        <description>&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Merkle_tree&quot;&gt;Merkle Tree&lt;/a&gt; is a tree where the leaf
nodes contain the hashes of some data blocks, and the internal nodes contain
hashes of their children. It provides a quick way to verify data. For example,
in a peer-to-peer network, a peer can use a Merkle Tree or parts of it (explain
later) to quickly verify the data it receives from other peers have not been
tampered with, or the data are not corrupted during the transmission. Borrowing
from wikipedia, below is a picture of what a Merkle Tree looks like.&lt;/p&gt;

&lt;div class=&quot;text-center&quot;&gt;
  &lt;img src=&quot;http://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Hash_Tree.svg/500px-Hash_Tree.svg.png&quot; height=&quot;300&quot; width=&quot;300&quot; alt=&quot;Merkle Tree&quot; /&gt;
&lt;/div&gt;

&lt;p&gt;The data blocks can be anything from a file being split into blocks or a set of
files. From the picture, it is easy to see that only top hash is needed to
verify the data blocks are valid. As a result, the top hash is usually acquired
through a trusted source, for example, inside a
&lt;a href=&quot;http://www.bittorrent.org/beps/bep_0030.html&quot;&gt;*.torrent&lt;/a&gt; file. If any of the
data block is corrupted or altered, the hashes along the path from root to the
corrupted block will be different.&lt;/p&gt;

&lt;p&gt;As mentioned earlier, you can verify the validity a data block without having
the whole Merkle Tree. Referring to the above diagram, say, if you want to
verify if data block &lt;code&gt;1&lt;/code&gt; is valid, you only need &lt;code&gt;Hash 0-1&lt;/code&gt; and &lt;code&gt;Hash 1&lt;/code&gt;, which
you can get from your peers. First, you hash data block &lt;code&gt;1&lt;/code&gt;, which gives you
&lt;code&gt;Hash 0-0&lt;/code&gt;. Second, you combine &lt;code&gt;Hash 0-0&lt;/code&gt; with &lt;code&gt;Hash 0-1&lt;/code&gt; in order to compute
&lt;code&gt;Hash 0&lt;/code&gt;. Then combine &lt;code&gt;Hash 0&lt;/code&gt; and &lt;code&gt;Hash 1&lt;/code&gt; to get the root hash. Finally, you
can compare the root hash with the one you acquired through a trusted source. If
they match, that means data block &lt;code&gt;1&lt;/code&gt; is valid. However, if they don’t match, it
could mean either one or a combination of &lt;code&gt;Hash 0-1&lt;/code&gt;, &lt;code&gt;Hash 1&lt;/code&gt; or data block &lt;code&gt;1&lt;/code&gt;
is invalid.&lt;/p&gt;

&lt;h4 id=&quot;hash-function&quot;&gt;Hash Function&lt;/h4&gt;
&lt;p&gt;Since a Merkle Tree is basically a tree of hashes, a hash function is a
crucial component. I’m using &lt;code&gt;SHA-1&lt;/code&gt; as the hash function. You are free to
choose whatever hash function, of course.&lt;/p&gt;

&lt;p&gt;Below is the hash function I’m using in my Merkle Tree implementation. I’m using
the SHA-1 implementation that comes with JAVA. The output of the function is a
hex string. The input can either be a &lt;code&gt;String&lt;/code&gt;, or &lt;code&gt;byte[]&lt;/code&gt;.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hashfn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;apply str &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;#&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;%02x&amp;quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;                  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&amp;gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;doto &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;MessageDigest/getInstance&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;SHA-1&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;                        &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.update&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.getBytes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;String.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&amp;quot;UTF-8&amp;quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;                      &lt;span class=&quot;nv&quot;&gt;.digest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;tree-construction&quot;&gt;Tree Construction&lt;/h4&gt;
&lt;p&gt;The approach of this implementation is to, first, create a full binary tree,
then stick the hashes from the data blocks into the leaf nodes. Finally, compute
hashes all the up to the root.&lt;/p&gt;

&lt;p&gt;A quick note about the tree representation. I choose to use a linked list
approach, where each node has a reference to its right and left subtrees.
Another approach is to use an array to represent that tree. In my
implementation, Every node in the tree is a dictionary like the following:&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;def &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;node &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:left&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:right&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:height&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Here is a more detail rundown of the implementation. Given a list of hashes, my
implementation will construct a full binary tree with sufficient height such
that the hashes in the hash list can be filled into leaf nodes. The unfilled
leaf nodes will be filled with empty strings. The implementation recursively
constructs the tree from top to bottom in a depth-first fashion. The hash value
for a node is set after both its children are constructed. As it recurses down
to a leaf node, it will grab a hash from the given hash list. The updated
hash list is returned when it unwinds from the recursion.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;merkle-tree&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Math/ceil&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;log2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;count &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))]&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;first &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;merkle-tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;   &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;     &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;left-tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;merkle-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dec &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;right-tree&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;merkle-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dec &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-10&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;c1&quot;&gt;;; create a new node&lt;/span&gt;
&lt;a name=&quot;line-11&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;-&amp;gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:left&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:right&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:height&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;a name=&quot;line-12&quot;&gt;&lt;/a&gt;                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc &lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:left&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;left-tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-13&quot;&gt;&lt;/a&gt;                 &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc &lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:right&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;right-tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))]&lt;/span&gt;
&lt;a name=&quot;line-14&quot;&gt;&lt;/a&gt;       &lt;span class=&quot;c1&quot;&gt;;; update hashval of current node&lt;/span&gt;
&lt;a name=&quot;line-15&quot;&gt;&lt;/a&gt;       &lt;span class=&quot;c1&quot;&gt;;; if it is a leaf node, take a hash from hash list. Otherwise,&lt;/span&gt;
&lt;a name=&quot;line-16&quot;&gt;&lt;/a&gt;       &lt;span class=&quot;c1&quot;&gt;;; hash the concatenation of its children&amp;#39;s hashes.&lt;/span&gt;
&lt;a name=&quot;line-17&quot;&gt;&lt;/a&gt;       &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;if &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;&amp;gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-18&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;hashfn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;left-tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-19&quot;&gt;&lt;/a&gt;                                         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;right-tree&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;a name=&quot;line-20&quot;&gt;&lt;/a&gt;          &lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-21&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;assoc &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;first &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;drop &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;new-hashes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;usage&quot;&gt;Usage&lt;/h4&gt;
&lt;p&gt;Let’s define two helper functions, &lt;code&gt;random-bytes&lt;/code&gt;, and &lt;code&gt;create-hash-list&lt;/code&gt;. These
functions help making a list of hashes easily.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;random-bytes&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;([]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;random-bytes&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;a name=&quot;line-3&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;let &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SecureRandom.&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-4&quot;&gt;&lt;/a&gt;             &lt;span class=&quot;nv&quot;&gt;rand-bytes&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;byte-array&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
&lt;a name=&quot;line-5&quot;&gt;&lt;/a&gt;         &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;do&lt;/span&gt;
&lt;a name=&quot;line-6&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;.nextBytes&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;r&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;rand-bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;a name=&quot;line-7&quot;&gt;&lt;/a&gt;           &lt;span class=&quot;nv&quot;&gt;rand-bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;
&lt;a name=&quot;line-8&quot;&gt;&lt;/a&gt;
&lt;a name=&quot;line-9&quot;&gt;&lt;/a&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kd&quot;&gt;defn &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;create-hash-list&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;a name=&quot;line-10&quot;&gt;&lt;/a&gt;  &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;map &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;hashfn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;take &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;n&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;repeatedly&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;random-bytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))))&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;p&gt;Now you can construct a Merkle tree based on a list of hashes, and get its top
hash.&lt;/p&gt;

&lt;figure class=&quot;highlight&quot;&gt;&lt;pre&gt;&lt;code class=&quot;language-clojure&quot; data-lang=&quot;clojure&quot;&gt;&lt;a name=&quot;line-1&quot;&gt;&lt;/a&gt;&lt;span class=&quot;nv&quot;&gt;user=&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;ss&quot;&gt;:hashval&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;merkle-tree&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;create-hash-list&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
&lt;a name=&quot;line-2&quot;&gt;&lt;/a&gt;&lt;span class=&quot;s&quot;&gt;&amp;quot;f80ca0da9657a67cc7767ba3aa64658715b5b69f&amp;quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/figure&gt;

&lt;h4 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h4&gt;
&lt;p&gt;There is a main drawback with this implementation. Since the implementation is
using recursion, if the given hash list is very long, the &lt;code&gt;merkle-tree&lt;/code&gt; function
will blow the stack. All in all, Merkle Tree is a really neat data structure
that has many applications, especially in the space of peer-to-peer networks.&lt;/p&gt;
</description>
        <pubDate>Sat, 01 Feb 2014 00:00:00 -0500</pubDate>
        <link>http://www.marcoyuen.com/articles/2014/02/01/merkle-tree.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/articles/2014/02/01/merkle-tree.html</guid>
        
        <category>data structures</category>
        
        <category>clojure</category>
        
        
        <category>articles</category>
        
      </item>
    
      <item>
        <title>Hello Jekyll. Bye Tumblr.</title>
        <description>&lt;p&gt;After a year or so of neglect, I finally decided to rebuild my own web site.
This time around, the new design is more “blog”-centric. To generate this
website, I choose to use &lt;a href=&quot;http://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt;, and ditch Tumblr. I
will slowly migrate some of my old blog posts from Tumblr to here.&lt;/p&gt;

&lt;p&gt;I think Tumblr was a great platform, but I was getting tired of using the web
based editor. Every time I used the web editor, I felt so foregin and
cumbersome.  My editor of choice, of course, is &lt;a href=&quot;http://www.vim.org&quot;&gt;Vim&lt;/a&gt;. Using
a static site generator like &lt;a href=&quot;http://jekyllrb.com/&quot;&gt;Jekyll&lt;/a&gt;, I can use my
favourite editor, and markdown to create my posts. The look and feel of the blog
is consistent to rest of the site as well.&lt;/p&gt;
</description>
        <pubDate>Sun, 26 Jan 2014 00:00:00 -0500</pubDate>
        <link>http://www.marcoyuen.com/general/2014/01/26/first-post.html</link>
        <guid isPermaLink="true">http://www.marcoyuen.com/general/2014/01/26/first-post.html</guid>
        
        <category>announcement</category>
        
        
        <category>general</category>
        
      </item>
    
  </channel>
</rss>
